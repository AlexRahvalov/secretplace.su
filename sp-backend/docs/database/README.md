# Документация по базе данных SecretPlace.su

## Содержание
1. [Общая информация](#общая-информация)
2. [Схема базы данных](#схема-базы-данных)
3. [Структура таблиц](#структура-таблиц)
4. [Сервисы и утилиты](#сервисы-и-утилиты)
5. [Конфигурация](#конфигурация)

## Общая информация

Проект SecretPlace.su использует MariaDB/MySQL в качестве СУБД. Система разделена на две логические части:
- **Основная база данных сайта** - хранит информацию о серверах Minecraft, пользователях сайта и другие данные для работы веб-приложения.
- **Базы данных серверов** - отдельные базы данных для каждого Minecraft сервера, которые хранят данные модов (например, EasyAuth для авторизации).

Для инициализации и взаимодействия с базами данных в проекте используется модуль `DatabaseInitializer` и другие вспомогательные классы, расположенные в директории `src/services/database`.

## Схема базы данных

### Основная база данных сайта

Основная база данных содержит следующие таблицы:
- **servers** - информация о серверах Minecraft.

### Базы данных серверов

Каждый сервер может иметь свою собственную базу данных с различными таблицами, в зависимости от установленных модов:
- **easyauth** - таблица для хранения данных авторизации EasyAuth (если используется).

## Структура таблиц

### Таблица `servers`

Таблица `servers` хранит информацию о серверах Minecraft, включая их конфигурацию и данные для подключения к базе данных сервера.

| Поле | Тип | Описание |
|------|-----|----------|
| id | INT UNSIGNED | Уникальный идентификатор сервера (первичный ключ) |
| name | VARCHAR(100) | Название сервера (уникальное) |
| description | TEXT | Описание сервера |
| ip | VARCHAR(255) | IP-адрес сервера |
| port | INT | Порт сервера (по умолчанию 25565) |
| status | VARCHAR(20) | Статус сервера (online/offline/maintenance) |
| auth_type | VARCHAR(50) | Тип авторизации на сервере |
| db_host | VARCHAR(255) | Хост базы данных сервера |
| db_port | INT | Порт базы данных сервера (по умолчанию 3306) |
| db_user | VARCHAR(100) | Имя пользователя для подключения к БД сервера |
| db_password | VARCHAR(255) | Пароль для подключения к БД сервера |
| db_name | VARCHAR(100) | Имя базы данных сервера |
| created_at | TIMESTAMP | Дата и время создания записи |
| updated_at | TIMESTAMP | Дата и время последнего обновления записи |

## Сервисы и утилиты

Подробная документация о сервисах и утилитах для работы с базой данных:

- [Инициализатор базы данных](./initializer.md) - Документация по классу `DatabaseInitializer`
- [Подключение к базе данных](./connection.md) - Документация по работе с подключениями
- [Обработка ошибок](./error-handling.md) - Документация по обработке ошибок базы данных
- [Middleware](./middleware.md) - Документация по работе с middleware для базы данных

## Конфигурация

Конфигурация подключения к базе данных задается через переменные окружения в файле `.env`:

```
DB_HOST=localhost
DB_PORT=3306
DB_USER=admin
DB_PASSWORD=your_password
DB_NAME=secretplace
DB_CONNECTION_LIMIT=10
```

Для настройки проекта необходимо создать файл `.env` на основе `.env.example` и установить правильные значения параметров подключения к базе данных. 